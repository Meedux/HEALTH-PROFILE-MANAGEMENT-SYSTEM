@layout BHWLayout
@page "/bhw/{purok}/purok-health"
@using Baranggay_Health_Records.Shared
@inject Context context

<div class="container" style="margin-top: 86px;">
    <div class="row">
        <div class="col">
            <h1>Purok @purok Health Dashboard</h1>
        </div>
    </div>

    @{

        for (int i = 0; i < ill.Count; i++)
        {
            if (i % 3 == 0)
            {
                @:<div class="row" style="margin-bottom: 26px;">
            }

            <div class="col">
                <PurokHealthCard Purok="@purok" Name="@ill[i].GetName()" Count="@ill[i].GetOccurence()" />
            </div>

            if ((i + 1) % 3 == 0 || i == ill.Count - 1)
            {
                @:</div>
            }
        }
    }

    
    <div class="row" style="margin-bottom: 26px;">
        <div class="col">
            <PurokHealthCard Purok="@purok" Name="Households" Count="@HouseholdCount" />
        </div>
        <div class="col">
            <PurokHealthCard Purok="@purok" Name="Senior Citizen" Count="@SeniorCitizenCount" />
        </div>
    </div>
</div>

@code {
    [Parameter] public string purok { get; set; } = "";
    public int PrenatalCount { get; set; } = 0;
    public int DewormingCount { get; set; } = 0;
    public int HouseholdCount { get; set; } = 0;
    public int SeniorCitizenCount { get; set; } = 0;

    List<IllnessModel> ill = new List<IllnessModel>();

    protected override void OnInitialized()
    {
        ill = context.GetIllnesses();
        PrenatalCount = context.GetPrenatalCount();
        DewormingCount = context.GetDewormingCount();
        HouseholdCount = context.GetHouseholdCount();
        SeniorCitizenCount = context.GetSeniorCitizenCount();
    }

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender)
        {
            ill = context.GetIllnesses();
            PrenatalCount = context.GetPrenatalCount();
            DewormingCount = context.GetDewormingCount();
            HouseholdCount = context.GetHouseholdCount();
            SeniorCitizenCount = context.GetSeniorCitizenCount();
        }
        }
    }
}