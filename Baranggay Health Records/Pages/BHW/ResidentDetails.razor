@page "/bhw/resident/{ID:int}"
@layout BHWLayout
@inject Context context
@inject NavigationManager NavigationManager

<div class="container" style="margin-top: 86px;">
    <h1 class="text-center">User Details</h1>
</div>
<div class="container">
    <div class="row">
        <div class="col text-center"><img class="rounded-circle img-fluid" width="300" height="80" src="https://cdn-icons-png.flaticon.com/512/1253/1253756.png"></div>
        <div class="col">
            <div class="row">
                <div class="col d-flex justify-content-end mb-3">
                    @if(isEdit){
                        <button class="btn btn-success mr-2" @onclick="UpdateInformation">Update Information</button>
                        <a class="btn btn-warning" href="/bhw/resident/@ID">Exit</a>
                    }
                    else
                    {
                        <a class="btn btn-primary" href="/bhw/resident/@ID?isEdit=true">Edit</a>
                    }
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <p style="font-size: 26px;" class="d-flex align-items-center">
                        <strong>First Name</strong>:
                        @if(isEdit){
                            <input type="text" style="margin-left: 15px;" class="w-50 form-control" @bind="edited_firstName" />
                        }
                        else{
                             @firstName
                           }
                    </p>
                    <p style="font-size: 26px;" class="d-flex align-items-center">
                        <strong>Last Name</strong>:
                        @if (isEdit)
                        {
                            <input type="text" style="margin-left: 15px;" class="w-50 form-control" @bind="edited_lastName" />
                        }
                        else
                        {
                            @lastName
                        }
                    </p>
                    <p style="font-size: 26px;" class="d-flex align-items-center">
                        <strong>Middle Name</strong>: 
                         @if(isEdit){
                            <input type="text" style="margin-left: 15px;" class="w-50 form-control" @bind="edited_middleName" />
                        }
                        else{
                             @middleName
                           }    
                    </p>
                    <p style="font-size: 26px;" class="d-flex align-items-center">
                        <strong>Age</strong>: 
                        @if(isEdit){
                            <input type="number" style="margin-left: 15px;" class="w-50 form-control" @bind="edited_age" />
                        }
                        else{
                             @age
                        }    
                    </p>
                    <p style="font-size: 26px;" class="d-flex align-items-center">
                        <strong>Date of Birth</strong>:
                        @if (isEdit)
                        {
                            <input type="text" style="margin-left: 15px;" class="w-50 form-control" @bind="edited_dob" />
                        }
                        else
                        {
                            @dob
                        }
                    </p>
                </div>
            </div>
        </div>
    </div>
    <div class="row" style="margin-top: 20px;">
        <div class="col">
            <div class="row">
                <div class="col">
                    <p style="font-size: 26px;font-weight: bold;">Gender:</p>
                </div>
                <div class="col">
                    <p style="font-size: 26px;" class="d-flex align-items-center">
                        @if (isEdit)
                        {
                            <input type="text" style="margin-left: 15px;" class="w-80 form-control" @bind="edited_gender" />
                        }
                        else
                        {
                            @gender
                        }
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <p style="font-size: 26px;font-weight: bold;">Civil Status:</p>
                </div>
                <div class="col">
                    <p style="font-size: 26px;" class="d-flex align-items-center">
                        @if (isEdit)
                        {
                            <input type="text" style="margin-left: 15px;" class="w-80 form-control" @bind="edited_civil_status" />
                        }
                        else
                        {
                            @civil_status
                        }
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <p style="font-size: 26px;font-weight: bold;">Religion:</p>
                </div>
                <div class="col">
                    <p style="font-size: 26px;" class="d-flex align-items-center">
                        @if (isEdit)
                        {
                            <input type="text" style="margin-left: 15px;" class="w-80 form-control" @bind="edited_religion" />
                        }
                        else
                        {
                            @religion
                        }
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <p style="font-size: 26px;font-weight: bold;">Occupation:</p>
                </div>
                <div class="col">
                    <p style="font-size: 26px;" class="d-flex align-items-center">
                        @if (isEdit)
                        {
                            <input type="text" style="margin-left: 15px;" class="w-80 form-control" @bind="edited_occupation" />
                        }
                        else
                        {
                            @occupation
                        }
                     </p>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <p style="font-size: 26px;font-weight: bold;">Highest Educational Attainment:</p>
                </div>
                <div class="col">
                    <p style="font-size: 26px;" class="d-flex align-items-center">
                        @if (isEdit)
                        {
                            <input type="text" style="margin-left: 15px;" class="w-80 form-control" @bind="edited_ed_attain" />
                        }
                        else
                        {
                            @ed_attain
                        }
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <p style="font-size: 26px;font-weight: bold;">Household Number:</p>
                </div>
                <div class="col">
                    <p style="font-size: 26px;" class="d-flex align-items-center">
                        #
                        @if (isEdit)
                        {
                            <input type="number" style="margin-left: 15px;" class="w-80 form-control" @bind="edited_household_number" />
                        }
                        else
                        {
                            @household_number
                        }
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <p style="font-size: 26px;font-weight: bold;">Purok:</p>
                </div>
                <div class="col">
                    <p style="font-size: 26px;" class="d-flex align-items-center">
                        @if (isEdit)
                        {
                            <Select TValue="string" @bind-Value="@purok" Placeholder="Select Purok...." Class="form-control" @onchange="ChangePurok">
                                <SelectItem Value="String.Empty">Select Purok Where the Resident Currently Resides</SelectItem>
                                @foreach (string pur in purokList)
                                {
                                    <SelectItem Value="@pur">@pur</SelectItem>
                                }
                            </Select>
                        }
                        else
                        {
                            @purok
                        }
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="col">
                    <p style="font-size: 26px;font-weight: bold;">Status:</p>
                </div>
                <div class="col">
                    <p style="font-size: 26px;" class="d-flex align-items-center">
                        @if (isEdit)
                        {
                            <input type="text" style="margin-left: 15px;" class="w-80 form-control" @bind="edited_status_type" />
                        }
                        else
                        {
                            @status_type
                        }
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
<div class="container" style="margin-bottom: 36px;margin-top: 34px;">
    <h1 class="text-center">User Health Details</h1>
</div>
<div class="container" style="margin-bottom: 52px;">
    <div class="table-responsive">
        <table class="table">
            <thead>
                <tr>
                    <th>Status Type</th>
                    <th>Details</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Type of Illness(If Any)</td>
                    <td>
                        @if (isEdit)
                        {
                            <Select TValue="int" @bind-Value="@edited_illness_typeID" Placeholder="Select illness..." Class="form-control" @onchange="HandleChange">
                                <SelectItem Value="0">Select Occuring Illness to The Resident</SelectItem>
                                @foreach (var illness in Illnesses)
                                {
                                    <SelectItem Value="@illness.ID">@illness.IllnessName</SelectItem>
                                }
                            </Select>
                        }
                        else
                        {
                            @illness_type
                        }
                    </td>
                </tr>
                <tr>
                    <td>Weight</td>
                    <td>
                        @if (isEdit)
                        {
                            <input type="text" style="margin-left: 15px;" class="w-50 form-control" @bind="edited_weight" />
                        }
                        else
                        {
                            @weight
                        }
                    </td>
                </tr>
                <tr>
                    <td>Height</td>
                    <td>
                        @if (isEdit)
                        {
                            <input type="text" style="margin-left: 15px;" class="w-50 form-control" @bind="edited_height" />
                        }
                        else
                        {
                            @height
                        }
                    </td>
                </tr>
                <tr>
                    <td>Temperature</td>
                    <td>
                        @if (isEdit)
                        {
                            <input type="text" style="margin-left: 15px;" class="w-50 form-control" @bind="edited_temperature" />
                        }
                        else
                        {
                            @temperature
                        }
                    </td>
                </tr>
                <tr>
                    <td>Blood Pressure</td>
                    <td>
                        @if (isEdit)
                        {
                            <input type="text" style="margin-left: 15px;" class="w-50 form-control" @bind="edited_bloodPressure" />
                        }
                        else
                        {
                            @bloodPressure
                        }
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

@code {
    [Parameter] public int? ID { get; set; } = 0;

    [Parameter]
    [SupplyParameterFromQuery]
    public bool isEdit { get; set; } = true;

    String firstName        {get; set;} = "";
    String middleName       {get; set;} = "";
    String lastName         {get; set;} = "";
    String suffix           {get; set;} = "";
    String dob { get; set; } = "";
    int age { get; set; } = 0;
    String gender           {get; set;} = "";
    String civil_status     {get; set;} = "";
    String religion         {get; set;} = "";
    String occupation       {get; set;} = "";
    String fathers_name     {get; set;} = "";
    String mothers_name     {get; set;} = "";
    String head             {get; set;} = "";
    int? num_of_fam         {get; set;}
    String ed_attain        {get; set;} = "";
    int? household_number   {get; set;}
    String purok            {get; set;} = "";
    String status_type      {get; set;} = "";
    string illness_type     {get; set;} = "";
    int illness_typeID { get; set; }
    String weight           {get; set;} = "";
    String height           {get; set;} = "";
    String temperature      {get; set;} = "";
    String bloodPressure    {get; set;} = "";

    string[] purokList = { "1A", "1B", "2", "3", "4", "5", "6", "7", "8", "9", "10" };
    String edited_firstName { get; set; } = "";
    String edited_middleName { get; set; } = "";
    String edited_lastName { get; set; } = "";
    String edited_suffix { get; set; } = "";
    String edited_dob { get; set; } = "";
    int edited_age { get; set; }
    String edited_gender { get; set; } = "";
    String edited_civil_status { get; set; } = "";
    String edited_religion { get; set; } = "";
    String edited_occupation { get; set; } = "";
    String edited_fathers_name { get; set; } = "";
    String edited_mothers_name { get; set; } = "";
    String edited_head { get; set; } = "";
    int edited_num_of_fam { get; set; }
    String edited_ed_attain { get; set; } = "";
    int edited_household_number { get; set; }
    String edited_purok { get; set; } = "";
    String edited_status_type { get; set; } = "";
    string edited_illness_type { get; set; } = "";
    int edited_illness_typeID { get; set; }
    String edited_weight { get; set; } = "";
    String edited_height { get; set; } = "";
    String edited_temperature { get; set; } = "";
    String edited_bloodPressure { get; set; } = "";

    void ChangePurok(ChangeEventArgs args)
    {
        var selectedValue = Convert.ToString(args.Value);
        edited_purok = (selectedValue != null) ? selectedValue : "";
        Console.WriteLine($"Selected Purok: {purok}");
    }
    void HandleChange(ChangeEventArgs args)
    {
        var selectedValue = Convert.ToInt32(args.Value);
        edited_illness_typeID = selectedValue;
        Console.WriteLine($"Selected illness ID: {edited_illness_typeID}");
    }

    public List<IllnessModel> Illnesses = new List<IllnessModel>();


    protected override void OnInitialized()
    {
        Console.WriteLine($"Fetching user Data and Health status data with the user ID of {ID}");
        ResidentModel resident = context.GetResident(ID);
        HouseholdModel household = context.GetHousehold(ID);
        ResidentHealthStatusModel RHS = context.GetResidentHealthStatus(ID);


        //Fill up the Resident Details
        firstName = resident.GetResidentFirstName();
        lastName = resident.GetResidentLastName();
        middleName = resident.GetResidentMiddleName();
        age = resident.GetResidentAge();
        dob = resident.GetResidentDOB();
        gender = resident.GetResidentGender();
        civil_status = resident.GetResidentCivilStatus();
        religion = resident.GetResidentReligion();
        occupation = resident.GetOccupation();
        ed_attain = resident.GetEducationalAttainment();
        household_number = resident.GetHouseholdNumber();
        purok = resident.GetPurok();
        // status_type = resident.GetResidentCivilStatus();

        //Fill up the Household Details
        fathers_name = household.GetFathersName();
        mothers_name = household.GetMothersName();
        head = household.GetHeadofFamily();
        num_of_fam = household.GetFamilyCount();

        //Fill up the RHS Details
        illness_type = context.GetIllnessNameByID(RHS.GetIllnessType());
        illness_typeID = RHS.GetIllnessType();
        weight = RHS.GetWeight();
        height = RHS.GetHeight();
        temperature = RHS.GetTemperature();
        bloodPressure = RHS.GetBloodPressure();

        //same for the edited parts
        //Fill up the Resident Details
        edited_firstName = resident.GetResidentFirstName();
        edited_lastName = resident.GetResidentLastName();
        edited_middleName = resident.GetResidentMiddleName();
        edited_age = resident.GetResidentAge();
        edited_dob = resident.GetResidentDOB();
        edited_gender = resident.GetResidentGender();
        edited_civil_status = resident.GetResidentCivilStatus();
        edited_religion = resident.GetResidentReligion();
        edited_occupation = resident.GetOccupation();
        edited_ed_attain = resident.GetEducationalAttainment();
        edited_household_number = resident.GetHouseholdNumber();
        edited_purok = resident.GetPurok();
        // status_type = resident.GetResidentCivilStatus();

        //Fill up the Household Details
        edited_fathers_name = household.GetFathersName();
        edited_mothers_name = household.GetMothersName();
        edited_head = household.GetHeadofFamily();
        edited_num_of_fam = household.GetFamilyCount();

        //Fill up the RHS Details
        edited_illness_type = context.GetIllnessNameByID(RHS.GetIllnessType());
        edited_illness_typeID = RHS.GetIllnessType();
        edited_weight = RHS.GetWeight();
        edited_height = RHS.GetHeight();
        edited_temperature = RHS.GetTemperature();
        edited_bloodPressure = RHS.GetBloodPressure();
    }


    private void UpdateInformation()
    {
        ResidentModel residentModel = new ResidentModel();
        residentModel.FirstName = edited_firstName;
        residentModel.LastName = edited_lastName;
        residentModel.MiddleName = edited_middleName;
        residentModel.Age = edited_age;
        residentModel.Dob = edited_dob;
        residentModel.Gender = edited_gender;
        residentModel.Civil_status = edited_civil_status;
        residentModel.Religion = edited_religion;
        residentModel.Occupation = edited_occupation;
        residentModel.Ed_attain = edited_ed_attain;
        residentModel.Household_number = edited_household_number;
        residentModel.Purok = edited_purok;

        HouseholdModel householdModel = new HouseholdModel();
        householdModel.FathersName = edited_fathers_name;
        householdModel.MothersName = edited_mothers_name;
        householdModel.HeadofFamily = edited_head;
        householdModel.FamilyCount = edited_num_of_fam;

        ResidentHealthStatusModel rHSM = new ResidentHealthStatusModel();
        rHSM.TypeofillnessID = edited_illness_typeID;
        rHSM.Weight = edited_weight;
        rHSM.Height = edited_height;
        rHSM.Temperature = edited_temperature;
        rHSM.BloodPressure = edited_bloodPressure;

        context.UpdateResident(residentModel, ID);
        context.UpdateHousehold(householdModel, ID);
        context.UpdateResidentHealthStatus(rHSM, ID);

        NavigationManager.NavigateTo($"/bhw/resident/{ID}");
    }
}